
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>How to Use the SmartEM API Client &#8212; smartem-decisions 0.1.dev220+g5b499478d documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=4ae1632d" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- So that users can add custom icons -->
  <script src="../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../_static/documentation_options.js?v=ed6598ba"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=30646c52"></script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'how-to/use-core-http-api-client';</script>
    <script>
        DOCUMENTATION_OPTIONS.theme_version = '0.16.1';
        DOCUMENTATION_OPTIONS.theme_switcher_json_url = 'https://DiamondLightSource.github.io/smartem-decisions/switcher.json';
        DOCUMENTATION_OPTIONS.theme_switcher_version_match = 'main';
        DOCUMENTATION_OPTIONS.show_version_warning_banner =
            false;
        </script>
    <link rel="icon" href="../_static/dls-logo.svg"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Explanations" href="../explanations.html" />
    <link rel="prev" title="Run in a container" href="run-container.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="main" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/dls-logo.svg" class="logo__image only-light" alt=""/>
    <img src="../_static/dls-logo.svg" class="logo__image only-dark pst-js-only" alt=""/>
  
  
    <p class="title logo__title">smartem-decisions</p>
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../tutorials.html">
    Tutorials
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../how-to.html">
    How-to Guides
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../explanations.html">
    Explanations
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../reference.html">
    Reference
  </a>
</li>

  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/DiamondLightSource/smartem-decisions" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://pypi.org/project/smartem-decisions" title="PyPI" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fas fa-cube fa-lg" aria-hidden="true"></i>
            <span class="sr-only">PyPI</span></a>
        </li>
</ul></div>
      
        <div class="navbar-item">
<div class="version-switcher__container dropdown pst-js-only">
  <button id="pst-version-switcher-button-2"
    type="button"
    class="version-switcher__button btn btn-sm dropdown-toggle"
    data-bs-toggle="dropdown"
    aria-haspopup="listbox"
    aria-controls="pst-version-switcher-list-2"
    aria-label="Version switcher list"
  >
    Choose version  <!-- this text may get changed later by javascript -->
    <span class="caret"></span>
  </button>
  <div id="pst-version-switcher-list-2"
    class="version-switcher__menu dropdown-menu list-group-flush py-0"
    role="listbox" aria-labelledby="pst-version-switcher-button-2">
    <!-- dropdown will be populated by javascript on page load -->
  </div>
</div></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../tutorials.html">
    Tutorials
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../how-to.html">
    How-to Guides
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../explanations.html">
    Explanations
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../reference.html">
    Reference
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/DiamondLightSource/smartem-decisions" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://pypi.org/project/smartem-decisions" title="PyPI" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fas fa-cube fa-lg" aria-hidden="true"></i>
            <span class="sr-only">PyPI</span></a>
        </li>
</ul></div>
        
          <div class="navbar-item">
<div class="version-switcher__container dropdown pst-js-only">
  <button id="pst-version-switcher-button-3"
    type="button"
    class="version-switcher__button btn btn-sm dropdown-toggle"
    data-bs-toggle="dropdown"
    aria-haspopup="listbox"
    aria-controls="pst-version-switcher-list-3"
    aria-label="Version switcher list"
  >
    Choose version  <!-- this text may get changed later by javascript -->
    <span class="caret"></span>
  </button>
  <div id="pst-version-switcher-list-3"
    class="version-switcher__menu dropdown-menu list-group-flush py-0"
    role="listbox" aria-labelledby="pst-version-switcher-button-3">
    <!-- dropdown will be populated by javascript on page load -->
  </div>
</div></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="contribute.html">Contribute to the project</a></li>
<li class="toctree-l1"><a class="reference internal" href="run-container.html">Run in a container</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">How to Use the SmartEM API Client</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../how-to.html" class="nav-link">How-to Guides</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">How to Use the SmartEM API Client</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="how-to-use-the-smartem-api-client">
<h1>How to Use the SmartEM API Client<a class="headerlink" href="#how-to-use-the-smartem-api-client" title="Link to this heading">#</a></h1>
<p>This guide explains how to use the unified SmartEM API client to communicate with the SmartEM Core API.</p>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Link to this heading">#</a></h2>
<p>The SmartEM API Client provides a unified interface to interact with the SmartEM Core API. It supports both synchronous and asynchronous operations, making it flexible for different usage scenarios. The client also includes data conversion utilities to convert between EPU data models and API request/response models.</p>
</section>
<section id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Link to this heading">#</a></h2>
<p>The SmartEM API Client is included with the SmartEM Decisions package, so no additional installation is required.</p>
</section>
<section id="basic-usage">
<h2>Basic Usage<a class="headerlink" href="#basic-usage" title="Link to this heading">#</a></h2>
<section id="importing-the-client">
<h3>Importing the Client<a class="headerlink" href="#importing-the-client" title="Link to this heading">#</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">src.epu_data_intake.core_http_api_client</span><span class="w"> </span><span class="kn">import</span> <span class="n">SmartEMAPIClient</span>
</pre></div>
</div>
</section>
<section id="creating-a-client-instance">
<h3>Creating a Client Instance<a class="headerlink" href="#creating-a-client-instance" title="Link to this heading">#</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a client with default timeout (10 seconds)</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">SmartEMAPIClient</span><span class="p">(</span><span class="s2">&quot;http://localhost:8000&quot;</span><span class="p">)</span>

<span class="c1"># Create a client with custom timeout</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">SmartEMAPIClient</span><span class="p">(</span><span class="s2">&quot;http://localhost:8000&quot;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mf">30.0</span><span class="p">)</span>

<span class="c1"># Create a client with custom logger</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;my_logger&quot;</span><span class="p">)</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">SmartEMAPIClient</span><span class="p">(</span><span class="s2">&quot;http://localhost:8000&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="using-the-client-with-context-managers">
<h3>Using the Client with Context Managers<a class="headerlink" href="#using-the-client-with-context-managers" title="Link to this heading">#</a></h3>
<p>The client supports context managers to ensure proper resource cleanup:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Synchronous context manager</span>
<span class="k">with</span> <span class="n">SmartEMAPIClient</span><span class="p">(</span><span class="s2">&quot;http://localhost:8000&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
    <span class="c1"># Use the client...</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_status</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">status</span><span class="p">)</span>

<span class="c1"># Asynchronous context manager</span>
<span class="k">async</span> <span class="k">with</span> <span class="n">SmartEMAPIClient</span><span class="p">(</span><span class="s2">&quot;http://localhost:8000&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
    <span class="c1"># Use the client asynchronously...</span>
    <span class="n">status</span> <span class="o">=</span> <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">aget_status</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">status</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="synchronous-vs-asynchronous-methods">
<h2>Synchronous vs Asynchronous Methods<a class="headerlink" href="#synchronous-vs-asynchronous-methods" title="Link to this heading">#</a></h2>
<p>The client provides both synchronous and asynchronous methods for all operations. The asynchronous methods are prefixed with <code class="docutils literal notranslate"><span class="pre">a</span></code> (e.g., <code class="docutils literal notranslate"><span class="pre">aget_status</span></code> vs <code class="docutils literal notranslate"><span class="pre">get_status</span></code>).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Synchronous method</span>
<span class="n">acquisitions</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_acquisitions</span><span class="p">()</span>

<span class="c1"># Asynchronous method</span>
<span class="n">acquisitions</span> <span class="o">=</span> <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">aget_acquisitions</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="working-with-acquisitions">
<h2>Working with Acquisitions<a class="headerlink" href="#working-with-acquisitions" title="Link to this heading">#</a></h2>
<section id="creating-an-acquisition">
<h3>Creating an Acquisition<a class="headerlink" href="#creating-an-acquisition" title="Link to this heading">#</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">src.epu_data_intake.model.schemas</span><span class="w"> </span><span class="kn">import</span> <span class="n">EpuSessionData</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>

<span class="c1"># Create an acquisition from EPU session data</span>
<span class="n">session</span> <span class="o">=</span> <span class="n">EpuSessionData</span><span class="p">(</span>
    <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;my-acquisition-id&quot;</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;My Acquisition&quot;</span><span class="p">,</span>
    <span class="n">start_time</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span>
    <span class="n">storage_path</span><span class="o">=</span><span class="s2">&quot;/path/to/storage&quot;</span>
<span class="p">)</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">create_acquisition</span><span class="p">(</span><span class="n">session</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created acquisition with ID: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Alternatively, create directly with an API request model</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.smartem_decisions.model.http_request</span><span class="w"> </span><span class="kn">import</span> <span class="n">AcquisitionCreateRequest</span>

<span class="n">request</span> <span class="o">=</span> <span class="n">AcquisitionCreateRequest</span><span class="p">(</span>
    <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;my-acquisition-id&quot;</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;My Acquisition&quot;</span>
<span class="p">)</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">create_acquisition</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="retrieving-acquisitions">
<h3>Retrieving Acquisitions<a class="headerlink" href="#retrieving-acquisitions" title="Link to this heading">#</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get all acquisitions</span>
<span class="n">acquisitions</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_acquisitions</span><span class="p">()</span>
<span class="k">for</span> <span class="n">acq</span> <span class="ow">in</span> <span class="n">acquisitions</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Acquisition: </span><span class="si">{</span><span class="n">acq</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">acq</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Get a specific acquisition</span>
<span class="n">acquisition</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_acquisition</span><span class="p">(</span><span class="s2">&quot;acquisition-id&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Acquisition details: </span><span class="si">{</span><span class="n">acquisition</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">, Status: </span><span class="si">{</span><span class="n">acquisition</span><span class="o">.</span><span class="n">status</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="updating-an-acquisition">
<h3>Updating an Acquisition<a class="headerlink" href="#updating-an-acquisition" title="Link to this heading">#</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">src.smartem_decisions.model.http_request</span><span class="w"> </span><span class="kn">import</span> <span class="n">AcquisitionUpdateRequest</span>

<span class="n">update</span> <span class="o">=</span> <span class="n">AcquisitionUpdateRequest</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Updated Acquisition Name&quot;</span><span class="p">,</span>
    <span class="n">status</span><span class="o">=</span><span class="s2">&quot;completed&quot;</span>
<span class="p">)</span>
<span class="n">updated</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">update_acquisition</span><span class="p">(</span><span class="s2">&quot;acquisition-id&quot;</span><span class="p">,</span> <span class="n">update</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="deleting-an-acquisition">
<h3>Deleting an Acquisition<a class="headerlink" href="#deleting-an-acquisition" title="Link to this heading">#</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">client</span><span class="o">.</span><span class="n">delete_acquisition</span><span class="p">(</span><span class="s2">&quot;acquisition-id&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="working-with-hierarchical-data">
<h2>Working with Hierarchical Data<a class="headerlink" href="#working-with-hierarchical-data" title="Link to this heading">#</a></h2>
<p>The client supports the full hierarchy of entities:</p>
<ol class="arabic simple">
<li><p>Acquisition</p></li>
<li><p>Grid</p></li>
<li><p>Grid Square</p></li>
<li><p>Foil Hole</p></li>
<li><p>Micrograph</p></li>
</ol>
<p>Here’s an example of creating entities at each level:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create an acquisition</span>
<span class="n">acquisition</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">create_acquisition</span><span class="p">(</span><span class="n">EpuSessionData</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;acq-1&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Test Acquisition&quot;</span><span class="p">))</span>

<span class="c1"># Create a grid for the acquisition</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.epu_data_intake.model.schemas</span><span class="w"> </span><span class="kn">import</span> <span class="n">GridData</span>

<span class="n">grid</span> <span class="o">=</span> <span class="n">GridData</span><span class="p">(</span><span class="n">data_dir</span><span class="o">=</span><span class="s2">&quot;/path/to/grid&quot;</span><span class="p">)</span>
<span class="n">grid_response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">create_acquisition_grid</span><span class="p">(</span><span class="n">acquisition</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">grid</span><span class="p">)</span>

<span class="c1"># Create a grid square for the grid</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.epu_data_intake.model.schemas</span><span class="w"> </span><span class="kn">import</span> <span class="n">GridSquareData</span>

<span class="n">gridsquare</span> <span class="o">=</span> <span class="n">GridSquareData</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;gs-1&quot;</span><span class="p">,</span> <span class="n">data_dir</span><span class="o">=</span><span class="s2">&quot;/path/to/gridsquare&quot;</span><span class="p">)</span>
<span class="n">gridsquare_response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">create_grid_gridsquare</span><span class="p">(</span><span class="n">grid_response</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">gridsquare</span><span class="p">)</span>

<span class="c1"># Create a foil hole for the grid square</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.epu_data_intake.model.schemas</span><span class="w"> </span><span class="kn">import</span> <span class="n">FoilHoleData</span>

<span class="n">foilhole</span> <span class="o">=</span> <span class="n">FoilHoleData</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;fh-1&quot;</span><span class="p">,</span> <span class="n">gridsquare_id</span><span class="o">=</span><span class="n">gridsquare</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
<span class="n">foilhole_response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">create_gridsquare_foilhole</span><span class="p">(</span><span class="n">gridsquare_response</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">foilhole</span><span class="p">)</span>

<span class="c1"># Create a micrograph for the foil hole</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.epu_data_intake.model.schemas</span><span class="w"> </span><span class="kn">import</span> <span class="n">MicrographData</span><span class="p">,</span> <span class="n">MicrographManifest</span>

<span class="n">manifest</span> <span class="o">=</span> <span class="n">MicrographManifest</span><span class="p">(</span>
    <span class="n">unique_id</span><span class="o">=</span><span class="s2">&quot;mic-1&quot;</span><span class="p">,</span>
    <span class="n">acquisition_datetime</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span>
    <span class="n">detector_name</span><span class="o">=</span><span class="s2">&quot;K3&quot;</span><span class="p">,</span>
    <span class="n">energy_filter</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">phase_plate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">binning_x</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">binning_y</span><span class="o">=</span><span class="mi">1</span>
<span class="p">)</span>
<span class="n">micrograph</span> <span class="o">=</span> <span class="n">MicrographData</span><span class="p">(</span>
    <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;mic-1&quot;</span><span class="p">,</span>
    <span class="n">gridsquare_id</span><span class="o">=</span><span class="n">gridsquare</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
    <span class="n">foilhole_id</span><span class="o">=</span><span class="n">foilhole</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
    <span class="n">location_id</span><span class="o">=</span><span class="s2">&quot;loc-1&quot;</span><span class="p">,</span>
    <span class="n">high_res_path</span><span class="o">=</span><span class="s2">&quot;/path/to/mic.mrc&quot;</span><span class="p">,</span>
    <span class="n">manifest_file</span><span class="o">=</span><span class="s2">&quot;/path/to/manifest.xml&quot;</span><span class="p">,</span>
    <span class="n">manifest</span><span class="o">=</span><span class="n">manifest</span>
<span class="p">)</span>
<span class="n">micrograph_response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">create_foilhole_micrograph</span><span class="p">(</span><span class="n">foilhole_response</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">micrograph</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="entitystore-compatibility">
<h2>EntityStore Compatibility<a class="headerlink" href="#entitystore-compatibility" title="Link to this heading">#</a></h2>
<p>The client maintains compatibility with the existing <code class="docutils literal notranslate"><span class="pre">EntityStore</span></code> API for seamless integration:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create an entity through the EntityStore compatibility API</span>
<span class="n">success</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s2">&quot;acquisition&quot;</span><span class="p">,</span> <span class="s2">&quot;acq-id&quot;</span><span class="p">,</span> <span class="n">session_data</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

<span class="c1"># Create a grid with parent relationship</span>
<span class="n">success</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s2">&quot;grid&quot;</span><span class="p">,</span> <span class="s2">&quot;grid-id&quot;</span><span class="p">,</span> <span class="n">grid_data</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;acquisition&quot;</span><span class="p">,</span> <span class="s2">&quot;acq-id&quot;</span><span class="p">))</span>
</pre></div>
</div>
</section>
<section id="error-handling">
<h2>Error Handling<a class="headerlink" href="#error-handling" title="Link to this heading">#</a></h2>
<p>The client includes comprehensive error handling:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_acquisition</span><span class="p">(</span><span class="s2">&quot;non-existent-id&quot;</span><span class="p">)</span>
<span class="k">except</span> <span class="n">httpx</span><span class="o">.</span><span class="n">HTTPStatusError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;HTTP error </span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="logging">
<h2>Logging<a class="headerlink" href="#logging" title="Link to this heading">#</a></h2>
<p>The client includes detailed logging. You can configure the log level to control verbosity:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>  <span class="c1"># For normal operation</span>
<span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>  <span class="c1"># For more detailed logs including request/response data</span>
</pre></div>
</div>
</section>
<section id="advanced-usage">
<h2>Advanced Usage<a class="headerlink" href="#advanced-usage" title="Link to this heading">#</a></h2>
<section id="working-with-raw-api-responses">
<h3>Working with Raw API Responses<a class="headerlink" href="#working-with-raw-api-responses" title="Link to this heading">#</a></h3>
<p>If you need to work with the raw API responses rather than parsed models:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">raw_response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">_request</span><span class="p">(</span><span class="s2">&quot;get&quot;</span><span class="p">,</span> <span class="s2">&quot;status&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">raw_response</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="managing-the-id-mapping-cache">
<h3>Managing the ID Mapping Cache<a class="headerlink" href="#managing-the-id-mapping-cache" title="Link to this heading">#</a></h3>
<p>The client maintains a cache of entity IDs to database IDs:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get a mapped database ID</span>
<span class="n">db_id</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">_get_db_id</span><span class="p">(</span><span class="s2">&quot;acquisition&quot;</span><span class="p">,</span> <span class="s2">&quot;entity-id&quot;</span><span class="p">)</span>

<span class="c1"># Store a mapping manually (normally done automatically)</span>
<span class="n">client</span><span class="o">.</span><span class="n">_store_entity_id_mapping</span><span class="p">(</span><span class="s2">&quot;acquisition&quot;</span><span class="p">,</span> <span class="s2">&quot;entity-id&quot;</span><span class="p">,</span> <span class="s2">&quot;db-id&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="closing-the-client">
<h2>Closing the Client<a class="headerlink" href="#closing-the-client" title="Link to this heading">#</a></h2>
<p>Always close the client when you’re done to free up resources:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Explicitly close</span>
<span class="n">client</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="c1"># Or use context managers (recommended)</span>
<span class="k">with</span> <span class="n">SmartEMAPIClient</span><span class="p">(</span><span class="s2">&quot;http://localhost:8000&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
    <span class="c1"># Client will be automatically closed when exiting the context</span>
    <span class="k">pass</span>
</pre></div>
</div>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="run-container.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Run in a container</p>
      </div>
    </a>
    <a class="right-next"
       href="../explanations.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Explanations</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#overview">Overview</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#installation">Installation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#basic-usage">Basic Usage</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#importing-the-client">Importing the Client</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#creating-a-client-instance">Creating a Client Instance</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#using-the-client-with-context-managers">Using the Client with Context Managers</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#synchronous-vs-asynchronous-methods">Synchronous vs Asynchronous Methods</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#working-with-acquisitions">Working with Acquisitions</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#creating-an-acquisition">Creating an Acquisition</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#retrieving-acquisitions">Retrieving Acquisitions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#updating-an-acquisition">Updating an Acquisition</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#deleting-an-acquisition">Deleting an Acquisition</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#working-with-hierarchical-data">Working with Hierarchical Data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#entitystore-compatibility">EntityStore Compatibility</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#error-handling">Error Handling</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#logging">Logging</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#advanced-usage">Advanced Usage</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#working-with-raw-api-responses">Working with Raw API Responses</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#managing-the-id-mapping-cache">Managing the ID Mapping Cache</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#closing-the-client">Closing the Client</a></li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">

  
  <div class="tocsection editthispage">
    <a href="https://github.com/DiamondLightSource/smartem-decisions/edit/main/docs/how-to/use-core-http-api-client.md">
      <i class="fa-solid fa-pencil"></i>
      
      
        
          Edit on GitHub
        
      
    </a>
  </div>
</div>

  <div class="sidebar-secondary-item">
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/how-to/use-core-http-api-client.md.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  <!-- # L10n: Setting the PST URL as an argument as this does not need to be localized -->
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>