 graph TD
    subgraph k8s["Kubernetes Cluster (Scientific Compute)"]
        subgraph core["Core Services"]
            api["SmartEM Core Service & API"]
            dp["Data Processing Pipeline & ML Services"]
        end

        subgraph infrastructure["Infrastructure Components"]
            log["Logging Backend (Graylog)"]
            db[("Persistent App State (PostgreSQL)")]
            mq[("Event Broker\n(RabbitMQ)")]
        end
    end

    subgraph ext["Acquisition Systems (external)"]
        direction TB
        em["Electron Microscope (ThermoFisher)"]
        gpfs[("GPFS")]
        epu["EPU Workstation (Windows with cygwin)"]
        athena["Athena HTTP API Server"]
    end

    %% Internal connections
    api --> db
    api --> mq
    dp --> mq
    api --> log

    %% External connections
    em --> epu
    epu --> gpfs
    epu --> athena
    api --> athena
    epu --> api

    %% Styling
    classDef k8s fill:#e6f3ff,stroke:#666
    classDef core fill:#f9f9f9,stroke:#666
    classDef infra fill:#f5f5f5,stroke:#666
    classDef ext fill:#fff5e6,stroke:#666

    class k8s k8s
    class core core
    class infrastructure infra
    class ext ext
    %% Link styling
    linkStyle 0,1,2,3,4,5,6,7,8 stroke:#666
